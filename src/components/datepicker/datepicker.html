<div class="m-datepicker"
     :class="{ 'm--is-disabled': isDisabled,
               'm--is-readonly': isReadonly,
               'm--is-waiting': isWaiting,
               'm--has-error': calandarError,
               'm--is-valid': isValid,
               'm--has-validation-message': hasValidationMessage }">
    <m-input-style :label="label"
                   :label-for="id"
                   :disabled="isDisabled"
                   :readonly="isReadonly"
                   :waiting="isWaiting"
                   :focus="open"
                   :empty="isEmpty"
                   :error="calandarError"
                   :valid="isValid"
                   v-m-popup:popup>
        <input type="text"
               ref="input"
               :id="id"
               aria-haspopup="true"
               :aria-controls="ariaControls1 + ' ' + ariaControls2"
               :aria-expanded="open"
               :disabled="isDisabled || isWaiting"
               :readonly="isReadonly"
               :placeholder="placeholder"
               @keydown.delete="inputOnKeydownDelete"
               @keydown.enter="inputOnKeydownEnter"
               @keydown.return="inputOnKeydownEnter"
               @keydown.esc="inputOnKeydownEsc"
               @keydown.tab="inputOnKeydownTab"
               @keydown="inputOnKeydown"
               @change="validateDate"
               @focus="inputOnFocus"
               @blur="onBlur"
               @click.stop
               :value="formattedDate" />
        <m-icon-button slot="right-content"
                       class="m-datepicker__icon"
                       icon-name="m-svg__calendar"
                       :disabled="!active"
                       button-size="22px"
                       :aria-controls="id"
                       @keydown.enter.prevent="open = !isDisabled">
            <m-i18n k="m-datepicker:open"
                    v-if="!open"></m-i18n>
            <m-i18n k="m-datepicker:close"
                    v-if="open"></m-i18n>
        </m-icon-button>
    </m-input-style>
    <m-validation-message class="m-datepicker__validation-message"
                          :disabled="isDisabled"
                          :waiting="isWaiting"
                          :error="calandarError"
                          :error-message="calandarErrorMessage"
                          :valid-message="validMessage"
                          :helper-message="helperMessage"></m-validation-message>
    <m-popup ref="popup"
             :open.sync="open"
             :disabled="!active"
             :close-on-backdrop="true"
             :focus-management="isMqMaxS"
             :padding="false"
             placement="bottom"
             @open="onOpen"
             @close="onClose">
        <m-calendar :value="formattedDate"
                    @input="selectDate"
                    :min-date="minDateString"
                    :max-date="maxDateString"
                    :show-month-before-after="false"></m-calendar>
    </m-popup>
</div>
